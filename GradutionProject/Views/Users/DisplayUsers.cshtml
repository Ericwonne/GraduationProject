@model System.Data.DataTable
@{
    ViewBag.Title = "Display Users";
}
@*<link href="http://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="~/Content/htmleaf-demo.css" />
    <link rel="stylesheet" type="text/css" href="~/Content/samples-styles.css" />*@
<style type="text/css">
    td.alt {
        background-color: #ffc;
        background-color: rgba(230, 127, 34, 0.2);
    }
</style>
<body onload="loadPinyin();">
    <h2>教务管理系统的所有用户（管理员除外）</h2>
    <br />
    <div class="container">
        <div class="input-group">
            <div class="input-group-addon"><i class="fa fa-search fa-lg"></i>&nbsp;</div>
            <input class="form-control" type="search" id="input-filter" size="15" placeholder="搜索表格中的条目" />
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <small><i class="glyphicon glyphicon-question-sign" style="color:forestgreen"></i></small> 用户类型（S:学生  T:教师）
            &nbsp;&nbsp;&nbsp;&nbsp;
        </div>
        <table class="table">
            <thead>
                <tr>
                    @*@foreach (var col in Model.Columns)
                        {
                            <td>@col</td>
                        }*@
                    <th><i class="fa fa-hashtag"></i>&nbsp;姓名 </th>
                    <th><i class="fa fa-hashtag"></i>&nbsp;电子邮箱</th>
                    <th><i class="fa fa-hashtag"></i>&nbsp;注册日期</th>
                    <th><i class="fa fa-hashtag"></i>&nbsp;用户类型</th>
                    <th><i class="fa fa-hashtag"></i>&nbsp;操作</th>
                </tr>
            </thead>
            <tbody>
                @foreach (System.Data.DataRow rows in Model.Rows)
                {
                    <tr>
                        <td><a name="hiddena" style="color:blue" href="SpecificUser?id=@rows[0]">@rows[1]</a></td>
                        <td><a href="mailto:@rows[2]">@rows[2]</a></td>
                        <td>@rows[3]</td>
                        <td>@rows[4]</td>
                        <td>
                            <!--傻傻的方法 onclick="getSpecificInfo(this.parentElement.parentElement.children[0].children[0].getAttribute('href').split('=')[1])"-->
                            <button class="btn btn-link" data-toggle="modal" data-target="#myModal" onclick="getSpecificInfo('@rows[0]', '@rows[1]')">
                                管理
                            </button>
                        </td>
                        <td class="hidden"></td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- 模态框（Modal） -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="myModalLabel"></h4>
                </div>
                <div id="modal-body" class="modal-body" style="margin-top:0">
                </div>
                <div class="modal-footer" style="margin-top:0">
                    <button type="button" class="btn btn-default" data-dismiss="modal">
                        关闭
                    </button>
                    <button type="button" class="btn btn-primary">
                        提交更改
                    </button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal -->
    </div>
</body>
<script src="http://cdn.bootcss.com/jquery/1.11.0/jquery.min.js" type="text/javascript"></script>
<script src="~/Scripts/jquery-1.10.2.min.js"></script>
<script src="~/Scripts/jquery.filtertable.min.js"></script>

<script>
    $(document).ready(function () {
        $('table').filterTable({ // apply filterTable to all tables on this page
            inputSelector: '#input-filter' // use the existing input instead of creating a new one
        });
    });

    function loadPinyin() {
        var aList = document.getElementsByName("hiddena");
        var hiddenList = document.getElementsByClassName("hidden");

        for (var index = 0; index < aList.length; index++) {
            hiddenList[index].innerText = ConvertPinyin(aList[index].innerText);
        }
    }

    function getSpecificInfo(id, name) {
        document.getElementById('myModalLabel').innerHTML = "修改" + name + "的信息";
        var result = "";
        $.ajax({
            type: "GET",
            url: "GetSpecificUser",
            data: "id=" + id,
            contentType: false,
            processData: false,
            async: false,               //同步: Google"如何获取Ajax的返回值,了解只有同步机制下可以获取返回值，否则获取到的就是undefined"
            success: function (response) {
                result = response;
            },
            error: function (response) {
                console.log(response);
            }
        });
        result = result.split('&');
        var one_record = "", element = "<table class='table table-stripped'>";

        for (var i = 0; i < result.length; i++) {
            one_record = result[i].split('=');      //one_record[0]: attribute;   one_record[1]: value;
            element += "<tr><td><label>" + one_record[0].toUpperCase() + "</label></td>" + "<td><input type='text' class='form-control' value=" + one_record[1] + " /></td></tr>";
        }
        element += "</table>";
        document.getElementById("modal-body").innerHTML = element;
    }

</script>